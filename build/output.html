<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tonosama Library</title>
    <!-- MathJax -->
    <script>
        var MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- css -->
    <link rel="stylesheet" type="text/css" href="output.css" />
</head>
<body>
    <h1 id="title">tonosama Library</h1>
    <!-- 目次 -->
    <nav id="toc" role="doc-toc">
        <ol>
            
    <li><a href="#template">template</a></li>
    <ol>
    <li><a href="#hash.sh">hash.sh</a></li>
    <li><a href="#settings.sh">settings.sh</a></li>
    <li><a href="#template.hpp">template.hpp</a></li>
    </ol>
    <li><a href="#data-structure">data-structure</a></li>
    <ol>
    <li><a href="#BIT.hpp">BIT.hpp</a></li>
    </ol>
    <li><a href="#math">math</a></li>
    <ol>
    </ol>
    <li><a href="#modint">modint</a></li>
    <ol>
    <li><a href="#BarrettReduction.hpp">BarrettReduction.hpp</a></li>
    <li><a href="#modint.hpp">modint.hpp</a></li>
    </ol>
    <li><a href="#FPS">FPS</a></li>
    <ol>
    <li><a href="#FFT.hpp">FFT.hpp</a></li>
    </ol>
    <li><a href="#graph">graph</a></li>
    <ol>
    </ol>
    <li><a href="#flow">flow</a></li>
    <ol>
    </ol>
    <li><a href="#string">string</a></li>
    <ol>
    </ol>
    <li><a href="#geometry">geometry</a></li>
    <ol>
    </ol>
    <li><a href="#memo">memo</a></li>
    <ol>
    </ol>
        </ol>
    </nav>

    
    <h2 class="section" id="template">template</h2>

    <div class="filename">
        <h2 id="hash.sh">hash.sh</h2>
    </div>
<div class="content">
    <pre><code><span class="token comment"># 使い方: sh hash.sh -> コピペ -> Ctrl + D</span>
<span class="token comment"># コメント・空白・改行を削除して md5 でハッシュする</span>
g++ <span class="token parameter variable">-dD</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-fpreprocessed</span> - <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'[:space:]'</span> <span class="token operator">|</span> md5sum <span class="token operator">|</span> <span class="token function">cut</span> -c-6
</code></pre>
</div>

    <div class="filename">
        <h2 id="settings.sh">settings.sh</h2>
    </div>
<div class="content">
    <pre><code><span class="token comment"># CLion の設定</span>
Settings → Build → CMake → Reload CMake Project
add_compile_options<span class="token punctuation">(</span>-D_GLIBCXX_DEBUG<span class="token punctuation">)</span>
<span class="token comment"># Caps Lock を Ctrl に変更</span>
setxkbmap <span class="token parameter variable">-option</span> ctrl:nocaps
</code></pre>
</div>

    <div class="filename">
        <h2 id="template.hpp">template.hpp</h2>
        md5: 365d7f

    </div>
<div class="content">
    <pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> ll <span class="token operator">=</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ll INF <span class="token operator">=</span> LLONG_MAX <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">rep</span><span class="token expression"><span class="token punctuation">(</span>i<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>ll i <span class="token operator">=</span> a<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">all</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token function">begin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span></span>
ll <span class="token function">sz</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token function">chmin</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   a <span class="token operator">=</span> b<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token function">chmax</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">>=</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   a <span class="token operator">=</span> b<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// your code here...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <h2 class="section" id="data-structure">data-structure</h2>

    <div class="filename">
        <h2 id="BIT.hpp">BIT.hpp</h2>
        md5: d8ec49

    </div>
<div class="content">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">BIT</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> a<span class="token punctuation">;</span>
   <span class="token function">BIT</span><span class="token punctuation">(</span>ll n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">a</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>ll p<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// A[p] += x</span>
      p<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> <span class="token function">sz</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         a<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
         p <span class="token operator">+=</span> p <span class="token operator">&amp;</span> <span class="token operator">-</span>p<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">sum</span><span class="token punctuation">(</span>ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         s <span class="token operator">+=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>
         r <span class="token operator">-=</span> r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> s<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">sum</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// sum of A[l, r)</span>
      <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">sum</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <h2 class="section" id="math">math</h2>

    <h2 class="section" id="modint">modint</h2>

    <div class="filename">
        <h2 id="BarrettReduction.hpp">BarrettReduction.hpp</h2>
        md5: b4bd2c

    </div>
<div class="content">
    <pre><code><span class="token keyword">using</span> u64 <span class="token operator">=</span> <span class="token keyword">uint64_t</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">Barrett</span> <span class="token punctuation">{</span>  <span class="token comment">// mod &lt; 2^32</span>
   u64 m<span class="token punctuation">,</span> im<span class="token punctuation">;</span>
   <span class="token function">Barrett</span><span class="token punctuation">(</span>u64 mod<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">im</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1ULL</span> <span class="token operator">/</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token comment">// input: a * b &lt; 2^64, output: a * b % mod</span>
   u64 <span class="token function">mul</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      a <span class="token operator">*=</span> b<span class="token punctuation">;</span>
      u64 x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__uint128_t<span class="token punctuation">)</span>a <span class="token operator">*</span> im<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">64</span><span class="token punctuation">;</span>
      a <span class="token operator">-=</span> x <span class="token operator">*</span> m<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span>a <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> a <span class="token operator">+=</span> m<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="modint.hpp">modint.hpp</h2>
        md5: 1dcff5

    </div>
<div class="content">
    <pre><code><span class="token keyword">const</span> ll mod <span class="token operator">=</span> <span class="token number">998244353</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">mm</span> <span class="token punctuation">{</span>
   ll x<span class="token punctuation">;</span>
   <span class="token function">mm</span><span class="token punctuation">(</span>ll x_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>x_ <span class="token operator">%</span> mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">+=</span> mod<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 4 行コピペ  Alt + Shift + クリックで複数カーソル</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">-=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">/=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   mm <span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> mod <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token function">pow</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> ll b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mm c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> c <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         a <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         b <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> c<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <h2 class="section" id="FPS">FPS</h2>

    <div class="filename">
        <h2 id="FFT.hpp">FFT.hpp</h2>
        md5: 10993d

    </div>
<div class="content">
    <pre><code><span class="token keyword">constexpr</span> ll <span class="token function">pow_mod_constexpr</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> ll n<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   uint _m <span class="token operator">=</span> <span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ull r <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   ull y <span class="token operator">=</span> x <span class="token operator">%</span> m<span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> r <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">%</span> _m<span class="token punctuation">;</span>
      y <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">%</span> _m<span class="token punctuation">;</span>
      n <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">constexpr</span> <span class="token keyword">bool</span> <span class="token function">is_prime_constexpr</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">7</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">61</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   ll d <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>d <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> d <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">constexpr</span> ll bases<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>ll a <span class="token operator">:</span> bases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll t <span class="token operator">=</span> d<span class="token punctuation">;</span>
      ll y <span class="token operator">=</span> <span class="token function">pow_mod_constexpr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">!=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         y <span class="token operator">=</span> y <span class="token operator">*</span> y <span class="token operator">%</span> n<span class="token punctuation">;</span>
         t <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> t <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> n<span class="token operator">></span> <span class="token keyword">constexpr</span> <span class="token keyword">bool</span> is_prime <span class="token operator">=</span> <span class="token function">is_prime_constexpr</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">constexpr</span> pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> ll<span class="token operator">></span> <span class="token function">inv_gcd</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">=</span> <span class="token function">safe_mod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   ll s <span class="token operator">=</span> b<span class="token punctuation">,</span> t <span class="token operator">=</span> a<span class="token punctuation">;</span>
   ll m0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> m1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

   <span class="token keyword">while</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll u <span class="token operator">=</span> s <span class="token operator">/</span> t<span class="token punctuation">;</span>
      s <span class="token operator">-=</span> t <span class="token operator">*</span> u<span class="token punctuation">;</span>
      m0 <span class="token operator">-=</span> m1 <span class="token operator">*</span> u<span class="token punctuation">;</span>  <span class="token comment">// |m1 * u| &lt;= |m1| * s &lt;= b</span>

      <span class="token keyword">auto</span> tmp <span class="token operator">=</span> s<span class="token punctuation">;</span>
      s <span class="token operator">=</span> t<span class="token punctuation">;</span>
      t <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
      tmp <span class="token operator">=</span> m0<span class="token punctuation">;</span>
      m0 <span class="token operator">=</span> m1<span class="token punctuation">;</span>
      m1 <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>m0 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> m0 <span class="token operator">+=</span> b <span class="token operator">/</span> s<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>s<span class="token punctuation">,</span> m0<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ull <span class="token function">floor_sum_unsigned</span><span class="token punctuation">(</span>ull n<span class="token punctuation">,</span> ull m<span class="token punctuation">,</span> ull a<span class="token punctuation">,</span> ull b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ull ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">>=</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ans <span class="token operator">+=</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
         a <span class="token operator">%=</span> m<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">>=</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ans <span class="token operator">+=</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
         b <span class="token operator">%=</span> m<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      ull y_max <span class="token operator">=</span> a <span class="token operator">*</span> n <span class="token operator">+</span> b<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>y_max <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      n <span class="token operator">=</span> <span class="token punctuation">(</span>ull<span class="token punctuation">)</span><span class="token punctuation">(</span>y_max <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      b <span class="token operator">=</span> <span class="token punctuation">(</span>ull<span class="token punctuation">)</span><span class="token punctuation">(</span>y_max <span class="token operator">%</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> <span class="token keyword">int</span> g <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span>primitive_root<span class="token operator">&lt;</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">fft_info</span> <span class="token punctuation">{</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">int</span> rank2 <span class="token operator">=</span> <span class="token function">countr_zero_constexpr</span><span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> rank2 <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">></span> root<span class="token punctuation">;</span>   <span class="token comment">// root[i]^(2^i) == 1</span>
   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> rank2 <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">></span> iroot<span class="token punctuation">;</span>  <span class="token comment">// root[i] * iroot[i] == 1</span>

   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rank2 <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span> rate2<span class="token punctuation">;</span>
   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rank2 <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span> irate2<span class="token punctuation">;</span>

   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rank2 <span class="token operator">-</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span> rate3<span class="token punctuation">;</span>
   array<span class="token operator">&lt;</span>mint<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rank2 <span class="token operator">-</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span> irate3<span class="token punctuation">;</span>

   <span class="token function">fft_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root<span class="token punctuation">[</span>rank2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mint</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> rank2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      iroot<span class="token punctuation">[</span>rank2<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>rank2<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> rank2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         root<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         iroot<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">{</span>
         mint prod <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> iprod <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> rank2 <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rate2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> prod<span class="token punctuation">;</span>
            irate2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> iprod<span class="token punctuation">;</span>
            prod <span class="token operator">*=</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            iprod <span class="token operator">*=</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">{</span>
         mint prod <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> iprod <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> rank2 <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rate3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> prod<span class="token punctuation">;</span>
            irate3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> iprod<span class="token punctuation">;</span>
            prod <span class="token operator">*=</span> iroot<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            iprod <span class="token operator">*=</span> root<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">butterfly</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> h <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token keyword">const</span> fft_info<span class="token operator">&lt;</span>mint<span class="token operator">></span> info<span class="token punctuation">;</span>

   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// a[i, i+(n>>len), i+2*(n>>len), ..] is transformed</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mint rot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> offset <span class="token operator">=</span> s <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> l <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> r <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> p<span class="token punctuation">]</span> <span class="token operator">*</span> rot<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">=</span> l <span class="token operator">+</span> r<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> l <span class="token operator">-</span> r<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span> rot <span class="token operator">*=</span> info<span class="token punctuation">.</span>rate2<span class="token punctuation">[</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         len<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mint rot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> imag <span class="token operator">=</span> info<span class="token punctuation">.</span>root<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mint rot2 <span class="token operator">=</span> rot <span class="token operator">*</span> rot<span class="token punctuation">;</span>
            mint rot3 <span class="token operator">=</span> rot2 <span class="token operator">*</span> rot<span class="token punctuation">;</span>
            <span class="token keyword">int</span> offset <span class="token operator">=</span> s <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> mod2 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a0 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a1 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rot<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a2 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rot2<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a3 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rot3<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a1na3imag <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> <span class="token function">mint</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> mod2 <span class="token operator">-</span> a3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> imag<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> na2 <span class="token operator">=</span> mod2 <span class="token operator">-</span> a2<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">=</span> a0 <span class="token operator">+</span> a2 <span class="token operator">+</span> a1 <span class="token operator">+</span> a3<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> a0 <span class="token operator">+</span> a2 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> mod2 <span class="token operator">-</span> <span class="token punctuation">(</span>a1 <span class="token operator">+</span> a3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> a0 <span class="token operator">+</span> na2 <span class="token operator">+</span> a1na3imag<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> a0 <span class="token operator">+</span> na2 <span class="token operator">+</span> <span class="token punctuation">(</span>mod2 <span class="token operator">-</span> a1na3imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span> rot <span class="token operator">*=</span> info<span class="token punctuation">.</span>rate3<span class="token punctuation">[</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         len <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">butterfly_inv</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> h <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token keyword">const</span> fft_info<span class="token operator">&lt;</span>mint<span class="token operator">></span> info<span class="token punctuation">;</span>

   <span class="token keyword">int</span> len <span class="token operator">=</span> h<span class="token punctuation">;</span>  <span class="token comment">// a[i, i+(n>>len), i+2*(n>>len), ..] is transformed</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mint irot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> offset <span class="token operator">=</span> s <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> l <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> r <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> p<span class="token punctuation">]</span><span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">=</span> l <span class="token operator">+</span> r<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ull<span class="token punctuation">)</span><span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> l<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> r<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> irot<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> irot <span class="token operator">*=</span> info<span class="token punctuation">.</span>irate2<span class="token punctuation">[</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         len<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         mint irot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> iimag <span class="token operator">=</span> info<span class="token punctuation">.</span>iroot<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mint irot2 <span class="token operator">=</span> irot <span class="token operator">*</span> irot<span class="token punctuation">;</span>
            mint irot3 <span class="token operator">=</span> irot2 <span class="token operator">*</span> irot<span class="token punctuation">;</span>
            <span class="token keyword">int</span> offset <span class="token operator">=</span> s <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>h <span class="token operator">-</span> len <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> a0 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a1 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a2 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">auto</span> a3 <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               <span class="token keyword">auto</span> a2na3iimag <span class="token operator">=</span> <span class="token number">1ULL</span> <span class="token operator">*</span> <span class="token function">mint</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> a2 <span class="token operator">-</span> a3<span class="token punctuation">)</span> <span class="token operator">*</span> iimag<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">=</span> a0 <span class="token operator">+</span> a1 <span class="token operator">+</span> a2 <span class="token operator">+</span> a3<span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a0 <span class="token operator">+</span> <span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a1<span class="token punctuation">)</span> <span class="token operator">+</span> a2na3iimag<span class="token punctuation">)</span> <span class="token operator">*</span> irot<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a0 <span class="token operator">+</span> a1 <span class="token operator">+</span> <span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a2<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> irot2<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               a<span class="token punctuation">[</span>i <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a0 <span class="token operator">+</span> <span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a2na3iimag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> irot3<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> irot <span class="token operator">*=</span> info<span class="token punctuation">.</span>irate3<span class="token punctuation">[</span><span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         len <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span>
vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> <span class="token function">convolution_naive</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> <span class="token function">ans</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ans<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ans<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span>
vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> <span class="token function">convolution_fft</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>internal<span class="token double-colon punctuation">::</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
   internal<span class="token double-colon punctuation">::</span><span class="token function">butterfly</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
   internal<span class="token double-colon punctuation">::</span><span class="token function">butterfly</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   internal<span class="token double-colon punctuation">::</span><span class="token function">butterfly_inv</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   mint iz <span class="token operator">=</span> <span class="token function">mint</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> iz<span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">mint</span><span class="token punctuation">,</span> internal<span class="token double-colon punctuation">::</span>is_static_modint_t<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token operator">></span>
vector<span class="token operator">&lt;</span>mint<span class="token operator">></span> <span class="token function">convolution</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>mint<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n <span class="token operator">||</span> <span class="token operator">!</span>m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">int</span> z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>internal<span class="token double-colon punctuation">::</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mint<span class="token double-colon punctuation">::</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> z <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">convolution_naive</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> internal<span class="token double-colon punctuation">::</span><span class="token function">convolution_fft</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">convolution_ll</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n <span class="token operator">||</span> <span class="token operator">!</span>m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull MOD1 <span class="token operator">=</span> <span class="token number">754974721</span><span class="token punctuation">;</span>  <span class="token comment">// 2^24</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull MOD2 <span class="token operator">=</span> <span class="token number">167772161</span><span class="token punctuation">;</span>  <span class="token comment">// 2^25</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull MOD3 <span class="token operator">=</span> <span class="token number">469762049</span><span class="token punctuation">;</span>  <span class="token comment">// 2^26</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull M2M3 <span class="token operator">=</span> MOD2 <span class="token operator">*</span> MOD3<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull M1M3 <span class="token operator">=</span> MOD1 <span class="token operator">*</span> MOD3<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull M1M2 <span class="token operator">=</span> MOD1 <span class="token operator">*</span> MOD2<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull M1M2M3 <span class="token operator">=</span> MOD1 <span class="token operator">*</span> MOD2 <span class="token operator">*</span> MOD3<span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull i1 <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span><span class="token function">inv_gcd</span><span class="token punctuation">(</span>MOD2 <span class="token operator">*</span> MOD3<span class="token punctuation">,</span> MOD1<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull i2 <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span><span class="token function">inv_gcd</span><span class="token punctuation">(</span>MOD1 <span class="token operator">*</span> MOD3<span class="token punctuation">,</span> MOD2<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull i3 <span class="token operator">=</span> internal<span class="token double-colon punctuation">::</span><span class="token function">inv_gcd</span><span class="token punctuation">(</span>MOD1 <span class="token operator">*</span> MOD2<span class="token punctuation">,</span> MOD3<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>

   <span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">int</span> MAX_AB_BIT <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
   <span class="token keyword">static_assert</span><span class="token punctuation">(</span>MOD1 <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1ull</span> <span class="token operator">&lt;&lt;</span> MAX_AB_BIT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"MOD1 isn't enough to support an array length of 2^24."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static_assert</span><span class="token punctuation">(</span>MOD2 <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1ull</span> <span class="token operator">&lt;&lt;</span> MAX_AB_BIT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"MOD2 isn't enough to support an array length of 2^24."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static_assert</span><span class="token punctuation">(</span>MOD3 <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1ull</span> <span class="token operator">&lt;&lt;</span> MAX_AB_BIT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"MOD3 isn't enough to support an array length of 2^24."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> MAX_AB_BIT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">auto</span> c1 <span class="token operator">=</span> <span class="token generic-function"><span class="token function">convolution</span><span class="token generic class-name"><span class="token operator">&lt;</span>MOD1<span class="token operator">></span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> c2 <span class="token operator">=</span> <span class="token generic-function"><span class="token function">convolution</span><span class="token generic class-name"><span class="token operator">&lt;</span>MOD2<span class="token operator">></span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> c3 <span class="token operator">=</span> <span class="token generic-function"><span class="token function">convolution</span><span class="token generic class-name"><span class="token operator">&lt;</span>MOD3<span class="token operator">></span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">c</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ull x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      x <span class="token operator">+=</span> <span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> i1<span class="token punctuation">)</span> <span class="token operator">%</span> MOD1 <span class="token operator">*</span> M2M3<span class="token punctuation">;</span>
      x <span class="token operator">+=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> i2<span class="token punctuation">)</span> <span class="token operator">%</span> MOD2 <span class="token operator">*</span> M1M3<span class="token punctuation">;</span>
      x <span class="token operator">+=</span> <span class="token punctuation">(</span>c3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> i3<span class="token punctuation">)</span> <span class="token operator">%</span> MOD3 <span class="token operator">*</span> M1M2<span class="token punctuation">;</span>
      ll diff <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> internal<span class="token double-colon punctuation">::</span><span class="token function">safe_mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">(</span>MOD1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> diff <span class="token operator">+=</span> MOD1<span class="token punctuation">;</span>
      <span class="token keyword">static</span> <span class="token keyword">constexpr</span> ull offset<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> M1M2M3<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M1M2M3<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> M1M2M3<span class="token punctuation">}</span><span class="token punctuation">;</span>
      x <span class="token operator">-=</span> offset<span class="token punctuation">[</span>diff <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      c<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <h2 class="section" id="graph">graph</h2>

    <h2 class="section" id="flow">flow</h2>

    <h2 class="section" id="string">string</h2>

    <h2 class="section" id="geometry">geometry</h2>

    <h2 class="section" id="memo">memo</h2>

</body>
</html>